    function toggleRecording(word, button) {
        if (mediaRecorder) {
            if (mediaRecorder.state === "inactive") {
                audioChunks = [];
                mediaRecorder.ondataavailable = event => audioChunks.push(event.data);

                mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/mpeg' });
                    const respondentId = getRespondentId();
                    const phaseFolder = `phase${currentPhase + 1}`;  // e.g., phase1, phase2
                    const versionFolder = `v${randomVersion}`; // v1, v2, v3, v4
                    const fileName = `${respondentId}/${phaseFolder}/${versionFolder}/${word}_${Date.now()}.mp3`;

                    const client = new OSS({
                        region: 'oss-rg-china-mainland',
                        accessKeyId: 'LTAI5tMVY9Jpm2MroinSie5z',
                        accessKeySecret: 'BU384EPr4lgFxnBEgwx041JaqSFts6',
                        bucket: 'linguisticstest',
                    });

                    try {
                        const result = await client.put(fileName, audioBlob);
                        console.log(`Uploaded successfully: ${result.url}`);

                        // Enable the Next Word button after uploading
                        nextWordButton.style.display = "block";
                        nextWordButton.disabled = false;
                    } catch (error) {
                        console.error("Upload failed:", error);
                        nextWordButton.style.display = "none";
                        nextWordButton.disabled = true;
                    }
                };

                mediaRecorder.start();
                button.textContent = "Stop Recording";
            } else {
                mediaRecorder.stop();
                button.textContent = "Recording Stopped";
            }
        }
    }

    function nextWord() {
        // Disable the button to prevent multiple clicks and hide it for a smooth transition
        nextWordButton.disabled = true;
        nextWordButton.style.display = "none";

        currentIndex++;
        if (currentIndex >= phases[currentPhase].content.length) {
            currentPhase++;
            if (currentPhase >= phases.length) {
                // End of all phases
                saveSurveyResults();
                document.body.innerHTML = `<div class="thank-you">Thank you for completing the test!</div>`;
                return;
            }
            renderInstructions();
        } else {
            renderWord();
        }
    }

    startTestButton.addEventListener("click", initializeTest);
</script>
